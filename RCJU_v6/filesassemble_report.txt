# RCJU Ansible project

## About the structure of the directory:
- **common** directory contains common variables
- **rcju** directory contains RCJU specific variables
- **roles** directory contains the roles


## Roles:
The roles main playbook will import the common and rcju variables
[defaults]
transport=network_cli
host_key_checking = false
StrictHostKeyChecking=no
gathering=explicit
inventory=./hosts

# This controls whether a failed Ansible playbook should create a .retry file. The default setting is True:
retry_files_enabled = False

# NAPALM specific
#library = /home/fab/Working/ansible_venv/lib/python3.7/site-packages/napalm_ansible/modules
#action_plugins = /home/fab/Working/ansible_venv/lib/python3.7/site-packages/napalm_ansible/plugins/action
library = ~/napalm_ansible
action_plugins= ~/napalm_ansible/plugins/action

#stdout_callback = selective
deprecation_warnings=False

[paramiko_connection]
# look_for_keys=True|False
# host_key_auto_add=True|False
# record_host_keys=True|False
# SYSLOG Compliance report:
# ------------------------
Host: R1, SYSLOG_server: logging host 10.28.4.54, buffered: 64000, trap: debugging, OK
Host: R2, SYSLOG_server: , buffered: , trap: , KO
Host: R3, SYSLOG_server: logging host 10.28.4.54, buffered: 640000, trap: debugging, KO
# SSHv2 Compliance report:
# ------------------------
Host: R1, SSH_version: ip ssh version 2, OK
Host: R2, SSH_version: ip ssh version 2, OK
Host: R3, SSH_version: ip ssh version 2, OK
# Timestamp Compliance report:
# ------------------------
Host: R1, timestamp debug: datetime msec localtime show-timezone, OK
Host: R1, timestamp log: datetime msec localtime show-timezone, OK
Host: R2, timestamp debug: datetime msec, KO
Host: R2, timestamp log: datetime msec localtime show-timezone, OK
Host: R3, timestamp debug: datetime msec, KO
Host: R3, timestamp log: datetime msec, KO
# SSHv2 Compliance report:
# ------------------------
Host: R1, SSH_version: ip ssh version 2, OK
Host: R2, SSH_version: ip ssh version 2, OK
Host: R3, SSH_version: ip ssh version 2, OK
[ios]
R1  ansible_host=192.168.125.101
R2  ansible_host=192.168.125.102
R3  ansible_host=192.168.125.103

[all:vars]
ansible_connection=network_cli
ansible_user=ansible
ansible_ssh_pass=ansible
ansible_become=yes
ansible_become_method=enable
ansible_become_password=cisco

[ios:vars]
ansible_network_os = ios
os = ios
---
- hosts: all
  connection: local                       # code is run locally
  gather_facts: no                        # don't gather facts
  
  tasks:
  - name: Grab configuration
    ios_command:
      commands: show running
    register: cfg
  - set_fact: config={{ cfg.stdout[0]|regex_replace("\A[^!]*","") }}
  - name: Save configuration to local file
    copy:
      content: "{{config}}"
      dest: "{{result_dir}}{{inventory_hostname}}.cfg"
    delegate_to: localhost

#
#
# - name: Save configuration to local file
#   copy:
#     content: "{{config}}"
#     dest: "{{repository}}/{{inventory_hostname}}.cfg"
#   delegate_to: localhost
#
# - name: configurable backup path
#   ios_config:
#     src: ios_template.j2
#     backup: yes
#     backup_options:
#       filename: backup.cfg
#       dir_path: /home/user
#
---
- name: TEST PLAYBOOK
  hosts: all
  connection: local                       # code is run locally
  gather_facts: no                        # don't gather facts

  vars_files:
  - ./rcju/vars/rcju.yml

  vars:
    result_dir: /var/lib/awx/projects/
  
  roles:
    - compliance                        # run the compliance role

---
- name: CONFIG EEM APPLET LOS ALL CMD
  hosts: all
  connection: local                       # code is run locally
  gather_facts: no                        # don't gather facts

  roles:
    - eem-applet-logs-all-cmd

---
- name: Execute show arp
  hosts: all
  connection: local                       # code is run locally
  gather_facts: no
  tasks:
    - raw: "show arp"
      register: result
    - debug: var=result.stdout_lines
---
- hosts: all
  connection: local                       # code is run locally
  gather_facts: no                        # don't gather facts
  tasks:
    - name: Collect all facts from the device
      ios_facts:
        gather_subset: all
      register: facts
    - debug: var=facts
---
- hosts: all
  connection: local                       # code is run locally
  gather_facts: no                        # don't gather facts
  tasks:
    - name: Send mail using Ansible
      mail:
        host: "smtp.gmail.com"
        port: 587
        username: "fabrice.rios@gmail.com"
        password: "=!XZUJ01"
        to: "fabrice.rios@gmail.com"
        subject: "Ansible test"
        body: "Hello from Ansible"
        secure: starttls
      delegate_to: localhost
      run_once: true

# NTP Compliance report:
# ----------------------
Host: R1, NTP_server: 192.168.254.1, Synchronized: False, KO
Host: R3, NTP_server: 192.168.254.1, Synchronized: False, KO
